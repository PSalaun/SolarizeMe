<!-- VARIABLES -->

<!-- This probably needs to be refactor into several components -->
<div class="wrapper-projects">
  <div class="container" id="js-cards-list">
    <%= javascript_pack_tag "init_charts" %>
    <div class="page-header text-center">
      <h1>My investments</h1>
    </div>


    <!-- tab to select project -->
    <div class="dashboard-tabs">
      <% count = 0 %>
      <% @user.investments.each do |investment| %>
        <% if count == 0 %>
          <%= link_to "#{investment.project.name}", "#", class: "all-investment-tabs dashboard-tab active", id: "investment-dash-tab-#{investment.id}" %>
        <% else %>
          <%= link_to "#{investment.project.name}", "#", class: "all-investment-tabs dashboard-tab", id: "investment-dash-tab-#{investment.id}" %>
        <% end %>
        <% count += 1 %>
      <% end %>
    </div>

    <% countdash = 0 %>
    <% @user.investments.each do |investment| %>
      <div id="main-dashboard-<%= investment.id %>" class="investment-all-dashes <%= 'dashboard-hide' if countdash > 0 %>" data-investmentprod="<%= investment.id %>" data-investment="<%= investment.id %>" >
      <% countdash += 1 %>
        <div class="cards-list" >
          <!-- Project detail div -->
          <%= link_to project_path(investment.project), class: "card-projects" do %>
            <%= cl_image_tag investment.project.photo, class: "card-project-image" %>
            <div class="container-info-card">
              <div class="card-header-projects text-left">
                <div class="card-title-and-company-name">
                  <h1> <%= investment.project.name %> </h1>
                  <h3> <%= investment.project.user.company_name %> </h3>
                  <br>
                </div>
                <%= cl_image_tag investment.project.user.photo, class: "card-company-logo" %>
              </div>
              <h3> <%= investment.project.description %></h3>
              <br>
              <div class="card-financial-details text-left">
                <div class="card__completion-rate-text">
                  <strong><%= number_to_percentage(investment.project.completion_rate, precision: 0)%></strong> funded
                </div>
                <strong><p>Yield: <%= investment.project.yield * 100 %> % per year  </p></strong>
              </div>
              <div class="card-horizontal-line"></div>
              <div class="card-investment-details text-left">
                <h2>You bought <%= investment.number_of_panels %> panels (<%= investment.kwc %> kWc) for a total investment of <strong><%= humanized_money_with_symbol(investment.amount) %></strong></h2>
                <h2> Income per year: <strong> <%= humanized_money_with_symbol(investment.income_per_year) %></strong></h2>
                <h2> Estimated lifetime gains: <strong><%= humanized_money_with_symbol(investment.total_gains) %></strong></h2>
              </div>
            </div>
          <% end %>

          <!-- Financials detail div -->
          <div class="card-projects ">
            <div class="container-info-card">
              <div class="card-header-projects-finance">
                <div class="card-title-and-company-name">
                  <h1>Financials</h1>
                </div>
              </div>
              <div class="card-investment-details">
                <div class="dashboard-box">
                <h2>
                  Project active for <%= investment.project.active_months %> months, <%= investment.project.remaining_months %> months remaining before end of contract
                </h2>
                <%= pie_chart ({"Past" => investment.project.active_months, "Remaining" => investment.project.remaining_months}), id: "pie-chart-#{investment.id}", height: "200px", donut: true,
                library: {
                    plotOptions: {
                      pie: {
                        dataLabels: {
                          enabled: false
                         },
                         showInLegend: true
                      }
                    }
                  } %>
                </div>
                <div class="dashboard-box">
                  <h2>Investment income in EUR</h2>
                  <%= bar_chart ({"Past gains" => investment.past_gains, "Remaining gains" => investment.remaining_gains}), id: "users-chart-#{investment.id}", height: "200px" %>
                </div>
              </div>
            </div>
          </div>

          <!-- Production detail div -->
          <div class="card-projects ">
            <div class="container-info-card">
              <div class="card-header-projects-finance">
                <div class="card-title-and-company-name">
                  <h1>Production</h1>
                </div>
              </div>

              <!-- tab to select production by period -->
              <div class="dashboard-tabs">
                <%= link_to "Daily", "#", class: "dashboard-tab active", id: "yourdaytab-#{investment.id}" %>
                <%= link_to "Monthly", "#", class: "dashboard-tab", id: "yourmonthtab-#{investment.id}" %>
                <%= link_to "Yearly", "#", class: "dashboard-tab", id: "youryearstab-#{investment.id}" %>
              </div>

              <div class="dashboard-box" id="daily-production-<%= investment.id %>">
                <h2>Today's performance, kW</h2>
                <%= line_chart investment.project.outputs.group_by_hour(:detailedtime, format: "%-l %P").average("production * #{investment.share_of_total_power}"), height: "200px" %>
              </div>

              <div class="dashboard-box dashboard-hide" id="monthly-production-<%= investment.id %>">
                <h2> Last month's production, kWh </h2>
                <%= column_chart investment.last_month_outputs.group_by_day(:date, format: "%d %m").sum("quantity * #{investment.share_of_total_power}"), height: "200px" %>
              </div>

              <div class="dashboard-box dashboard-hide" id="yearly-production-<%= investment.id %>">
                <h2> Last year's production, MWh </h2>
                <%= column_chart investment.project.outputs.group_by_month(:date, format: "%Y-%m").sum("quantity * #{investment.share_of_total_power}"), height: "200px" %>
              </div>

              <div class="card-investment-details text-left">
                <br>
                <h2>You will save <%= investment.co2_tonn_lifetime %> tonns of CO2.</h2>

                <h2>Equivalent to <%= number_with_precision(investment.elephants_lifetime, :precision => 0) %> elephants or:</h2>
                <h2> <i class="fas fa-tree"></i> Planting <%= number_with_precision(investment.co2_tonn_lifetime, :precision => 0) %> trees!</h2>
                <h2> <i class="fas fa-car-side"></i> Driving <%= number_with_precision(investment.km_car_lifetime, :precision => 0) %> km! </h2>
                <h2> <i class="fas fa-globe-americas"></i> Its <%= number_with_precision(investment.turns_world_lifetime, :precision => 0) %> times around the world!</h2>
                <h2>Good job!</h2>
              </div>
            </div>
          </div>
        </div>
      </div>

    <% end %>

    <!-- footers -->
    <div class="box-dashboard">
      <%= link_to "Edit my profile", edit_user_registration_path(current_user), class: "btn-main-green" %>
      <%= link_to 'Back', :back, class: "btn-ancilliary" %>
    </div>
  </div>
</div>




